<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/boycott/bittee-logo.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- CSP removed - Neocities sets its own CSP headers that override meta tags -->
    <!-- Audio files are hosted on GitHub and loaded via jsDelivr CDN -->
    <title>Bittee â€“ Falasteeni</title>
    <!-- Production: Try to find and load built file. Development: Load source file -->
    <script type="module">
      const isDev = window.location.hostname === 'localhost' || window.location.hostname.includes('127.0.0.1');
      
      if (isDev) {
        // Development: load source file
        const script = document.createElement('script');
        script.type = 'module';
        script.src = '/src/main.ts';
        document.head.appendChild(script);
      } else {
        // Production: Try to find the built file
        // First, try to fetch the built index.html from /boycott/
        fetch('/boycott/index.html')
          .then(response => {
            if (!response.ok) throw new Error('Not found');
            return response.text();
          })
          .then(html => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const scriptTag = doc.querySelector('script[type="module"]');
            const linkTag = doc.querySelector('link[rel="stylesheet"]');
            
            if (scriptTag && scriptTag.src) {
              // Load the built JS file
              const script = document.createElement('script');
              script.type = 'module';
              script.crossOrigin = 'anonymous';
              script.src = scriptTag.src;
              document.head.appendChild(script);
              
              // Load the built CSS file
              if (linkTag && linkTag.href) {
                const link = document.createElement('link');
                link.rel = 'stylesheet';
                link.crossOrigin = 'anonymous';
                link.href = linkTag.href;
                document.head.appendChild(link);
              }
            } else {
              throw new Error('Could not find built files in index.html');
            }
          })
          .catch(() => {
            // Fallback: Try to find index-*.js in assets directory
            // This is a last resort - try common patterns
            console.warn('Could not fetch /boycott/index.html, trying to find built file...');
            
            // Try to list assets directory (if directory listing is enabled)
            fetch('/boycott/assets/')
              .then(response => response.text())
              .then(html => {
                // Try to extract index-*.js from directory listing
                const match = html.match(/index-[\w-]+\.js/);
                if (match) {
                  const script = document.createElement('script');
                  script.type = 'module';
                  script.crossOrigin = 'anonymous';
                  script.src = `/boycott/assets/${match[0]}`;
                  document.head.appendChild(script);
                } else {
                  throw new Error('Could not find built file');
                }
              })
              .catch(() => {
                // Final fallback: Show error message
                document.getElementById('app').innerHTML = `
                  <div style="color: white; padding: 20px; text-align: center;">
                    <h2>Game failed to load</h2>
                    <p>Please ensure GitHub Pages is configured to use "GitHub Actions" as the source.</p>
                    <p style="font-size: 12px; color: #888;">Go to Settings > Pages > Source and select "GitHub Actions"</p>
                  </div>
                `;
              });
          });
      }
    </script>
  </head>
  <body>
    <div id="app"></div>
  </body>
</html>
